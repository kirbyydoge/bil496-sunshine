function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("core_reportbuilder/local/editor/columns",["exports","jquery","core/event_dispatcher","core/inplace_editable","core/local/inplace_editable/events","core/notification","core/pending","core/prefetch","core/pubsub","core/sortable_list","core/str","core/toast","core_reportbuilder/local/events","core_reportbuilder/local/selectors","core_reportbuilder/local/repository/columns","core_reportbuilder/local/repository/sorting"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){"use strict";Object.defineProperty(a,"__esModule",{value:!0});a.init=void 0;b=s(b);f=s(f);g=s(g);j=s(j);m=r(m);n=r(n);function q(){if("function"!=typeof WeakMap)return null;var a=new WeakMap;q=function(){return a};return a}function r(a){if(a&&a.__esModule){return a}if(null===a||"object"!==_typeof(a)&&"function"!=typeof a){return{default:a}}var b=q();if(b&&b.has(a)){return b.get(a)}var c={},d=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var e in a){if(Object.prototype.hasOwnProperty.call(a,e)){var f=d?Object.getOwnPropertyDescriptor(a,e):null;if(f&&(f.get||f.set)){Object.defineProperty(c,e,f)}else{c[e]=a[e]}}}c.default=a;if(b){b.set(a,c)}return c}function s(a){return a&&a.__esModule?a:{default:a}}var t=function(a){(0,h.prefetchStrings)("core_reportbuilder",["columnadded","columnaggregated","columndeleted","columnmoved","deletecolumn","deletecolumnconfirm"]);(0,h.prefetchStrings)("core",["delete"]);if(a){return}document.addEventListener("click",function(a){var b=a.target.closest(n.actions.reportAddColumn);if(b){a.preventDefault();var d=new g.default("core_reportbuilder/columns:add"),e=b.closest(n.regions.report);(0,o.addColumn)(e.dataset.reportId,b.dataset.uniqueIdentifier).then(function(a){return(0,i.publish)(m.publish.reportColumnsUpdated,a)}).then(function(){return(0,k.get_string)("columnadded","core_reportbuilder",b.dataset.name)}).then(l.add).then(function(){(0,c.dispatchEvent)(m.tableReload,{preservePagination:!0},e);return d.resolve()}).catch(f.default.exception)}var h=a.target.closest(n.actions.reportRemoveColumn);if(h){a.preventDefault();var j=h.closest(n.regions.report),p=h.closest(n.regions.columnHeader),q=p.dataset.columnName;f.default.saveCancelPromise((0,k.get_string)("deletecolumn","core_reportbuilder",q),(0,k.get_string)("deletecolumnconfirm","core_reportbuilder",q),(0,k.get_string)("delete","core"),{triggerElement:h}).then(function(){var a=new g.default("core_reportbuilder/columns:remove");return(0,o.deleteColumn)(j.dataset.reportId,p.dataset.columnId).then(function(a){return(0,i.publish)(m.publish.reportColumnsUpdated,a)}).then(function(){return(0,l.add)((0,k.get_string)("columndeleted","core_reportbuilder",q))}).then(function(){(0,c.dispatchEvent)(m.tableReload,{preservePagination:!0},j);return a.resolve()}).catch(f.default.exception)}).catch(function(){})}});var d=new j.default("".concat(n.regions.reportTable," thead tr"),{isHorizontal:!0});d.getElementName=function(a){return Promise.resolve(a.data("columnName"))};(0,b.default)(document).on(j.default.EVENTS.DRAG,"".concat(n.regions.report," th[data-column-id]"),function(a,c){var d=a.target.closest(n.regions.report),e=c.element.data("columnPosition"),f=c.targetNextElement.data("columnPosition");(0,b.default)(d).find("tbody tr").each(function(){var a=(0,b.default)(this).children("td.c".concat(e-1))[0];if(f){var c=(0,b.default)(this).children("td.c".concat(f-1))[0];this.insertBefore(a,c)}else{this.appendChild(a)}})});(0,b.default)(document).on(j.default.EVENTS.DROP,"".concat(n.regions.report," th[data-column-id]"),function(a,b){if(b.positionChanged){var d=new g.default("core_reportbuilder/columns:reorder"),e=a.target.closest(n.regions.report),h=b.element.data("columnId"),i=b.element.data("columnName"),j=b.element.data("columnPosition"),p=b.targetNextElement.data("columnPosition")||b.element.siblings().length+2;if(p>j){p--}(0,o.reorderColumn)(e.dataset.reportId,h,p).then(function(){return(0,k.get_string)("columnmoved","core_reportbuilder",i)}).then(l.add).then(function(){(0,c.dispatchEvent)(m.tableReload,{preservePagination:!0},e);return d.resolve()}).catch(f.default.exception)}});document.addEventListener(e.eventTypes.elementUpdated,function(a){var b=a.target.closest("[data-itemtype=\"columnaggregation\"]");if(b){var d=new g.default("core_reportbuilder/columns:aggregate"),e=b.closest(n.regions.report),h=b.closest(n.regions.columnHeader);(0,k.get_string)("columnaggregated","core_reportbuilder",h.dataset.columnName).then(l.add).then(function(){var a="[data-itemtype=\"columnaggregation\"][data-itemid=\""+"".concat(b.dataset.itemid,"\"] > a");(0,c.dispatchEvent)(m.tableReload,{preserveTriggerElement:a},e);return(0,p.getColumnSorting)(e.dataset.reportId)}).then(function(a){return(0,i.publish)(m.publish.reportColumnsUpdated,a)}).then(function(){return d.resolve()}).catch(f.default.exception)}})};a.init=t});
//# sourceMappingURL=columns.min.js.map
