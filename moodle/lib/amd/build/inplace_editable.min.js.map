{"version":3,"sources":["../src/inplace_editable.js"],"names":["define","$","ajax","templates","notification","str","cfg","url","autocomplete","Pending","Events","removeSpinner","element","removeClass","find","hide","updateValue","mainelement","value","silent","pendingId","attr","join","pendingPromise","addSpinner","call","methodname","args","itemid","component","itemtype","then","data","render","html","js","oldvalue","newelement","replaceNode","focus","notifyElementUpdated","get","resolve","fail","ex","M","util","js_complete","updateFailedEvent","notifyElementUpdateFailed","defaultPrevented","exception","addClass","spinner","length","show","imageUrl","append","on","e","type","keyCode","editingEnabledPromise","stopImmediatePropagation","preventDefault","target","closest","turnEditingOff","el","off","removeAttr","parents","uniqueId","prefix","idlength","uniqid","i","Math","floor","random","turnEditingOnText","get_string","done","s","instr","inputelement","lbl","select","behatsiterunning","val","turnEditingOnToggle","newvalue","turnEditingOnSelect","options","key","turnEditingOnAutocomplete","attributes","saveelement","cancelelement","multiple","JSON","parse","renderPix","enhance","tags","placeholder","caseSensitive","showSuggestions","noSelectionString","stringify","empty","turnEditingOffEverywhere","each","turnEditingOn","parseJSON","getInplaceEditable","parent","querySelector","getValue","dataset","setValue","getItemId"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * AJAX helper for the inline editing a value.\n *\n * This script is automatically included from template core/inplace_editable\n * It registers a click-listener on [data-inplaceeditablelink] link (the \"inplace edit\" icon),\n * then replaces the displayed value with an input field. On \"Enter\" it sends a request\n * to web service core_update_inplace_editable, which invokes the specified callback.\n * Any exception thrown by the web service (or callback) is displayed as an error popup.\n *\n * @module     core/inplace_editable\n * @copyright  2016 Marina Glancy\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.1\n */\ndefine(\n    ['jquery',\n        'core/ajax',\n        'core/templates',\n        'core/notification',\n        'core/str',\n        'core/config',\n        'core/url',\n        'core/form-autocomplete',\n        'core/pending',\n        'core/local/inplace_editable/events',\n    ],\n    function($, ajax, templates, notification, str, cfg, url, autocomplete, Pending, Events) {\n\n        const removeSpinner = function(element) {\n            element.removeClass('updating');\n            element.find('img.spinner').hide();\n        };\n\n        /**\n         * Update an inplace editable value.\n         *\n         * @param {Jquery} mainelement the element to update\n         * @param {string} value the new value\n         * @param {bool} silent if true the change won't alter the current page focus\n         * @fires event:core/inplace_editable:updated\n         * @fires event:core/inplace_editable:updateFailed\n         */\n        const updateValue = function(mainelement, value, silent) {\n            var pendingId = [\n                mainelement.attr('data-itemid'),\n                mainelement.attr('data-component'),\n                mainelement.attr('data-itemtype'),\n            ].join('-');\n            var pendingPromise = new Pending(pendingId);\n\n            addSpinner(mainelement);\n            ajax.call([{\n                methodname: 'core_update_inplace_editable',\n                args: {\n                    itemid: mainelement.attr('data-itemid'),\n                    component: mainelement.attr('data-component'),\n                    itemtype: mainelement.attr('data-itemtype'),\n                    value: value,\n                },\n            }])[0]\n                .then(function(data) {\n                    return templates.render('core/inplace_editable', data)\n                        .then(function(html, js) {\n                            var oldvalue = mainelement.attr('data-value');\n                            var newelement = $(html);\n                            templates.replaceNode(mainelement, newelement, js);\n                            if (!silent) {\n                                newelement.find('[data-inplaceeditablelink]').focus();\n                            }\n\n                            // Trigger updated event on the DOM element.\n                            Events.notifyElementUpdated(newelement.get(0), data, oldvalue);\n\n                            return;\n                        });\n                })\n                .then(function() {\n                    return pendingPromise.resolve();\n                })\n                .fail(function(ex) {\n                    removeSpinner(mainelement);\n                    M.util.js_complete(pendingId);\n\n                    // Trigger update failed event on the DOM element.\n                    let updateFailedEvent = Events.notifyElementUpdateFailed(mainelement.get(0), ex, value);\n                    if (!updateFailedEvent.defaultPrevented) {\n                        notification.exception(ex);\n                    }\n                });\n        };\n\n        const addSpinner = function(element) {\n            element.addClass('updating');\n            var spinner = element.find('img.spinner');\n            if (spinner.length) {\n                spinner.show();\n            } else {\n                spinner = $('<img/>')\n                    .attr('src', url.imageUrl('i/loading_small'))\n                    .addClass('spinner').addClass('smallicon')\n                    ;\n                element.append(spinner);\n            }\n        };\n\n        $('body').on('click keypress', '[data-inplaceeditable] [data-inplaceeditablelink]', function(e) {\n            if (e.type === 'keypress' && e.keyCode !== 13) {\n                return;\n            }\n            var editingEnabledPromise = new Pending('autocomplete-start-editing');\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            var target = $(this),\n                mainelement = target.closest('[data-inplaceeditable]');\n\n            var turnEditingOff = function(el) {\n                el.find('input').off();\n                el.find('select').off();\n                el.html(el.attr('data-oldcontent'));\n                el.removeAttr('data-oldcontent');\n                el.removeClass('inplaceeditingon');\n                el.find('[data-inplaceeditablelink]').focus();\n\n                // Re-enable any parent draggable attribute.\n                el.parents(`[data-inplace-in-draggable=\"true\"]`)\n                    .attr('draggable', true)\n                    .attr('data-inplace-in-draggable', false);\n            };\n\n            var turnEditingOffEverywhere = function() {\n                // Re-enable any disabled draggable attribute.\n                $(`[data-inplace-in-draggable=\"true\"]`)\n                    .attr('draggable', true)\n                    .attr('data-inplace-in-draggable', false);\n\n                $('span.inplaceeditable.inplaceeditingon').each(function() {\n                    turnEditingOff($(this));\n                });\n            };\n\n            var uniqueId = function(prefix, idlength) {\n                var uniqid = prefix,\n                    i;\n                for (i = 0; i < idlength; i++) {\n                    uniqid += String(Math.floor(Math.random() * 10));\n                }\n                // Make sure this ID is not already taken by an existing element.\n                if ($(\"#\" + uniqid).length === 0) {\n                    return uniqid;\n                }\n                return uniqueId(prefix, idlength);\n            };\n\n            var turnEditingOnText = function(el) {\n                str.get_string('edittitleinstructions').done(function(s) {\n                    var instr = $('<span class=\"editinstructions\">' + s + '</span>').\n                        attr('id', uniqueId('id_editinstructions_', 20)),\n                        inputelement = $('<input type=\"text\"/>').\n                            attr('id', uniqueId('id_inplacevalue_', 20)).\n                            attr('value', el.attr('data-value')).\n                            attr('aria-describedby', instr.attr('id')).\n                            addClass('ignoredirty').\n                            addClass('form-control'),\n                        lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>').\n                            attr('for', inputelement.attr('id'));\n                    el.html('').append(instr).append(lbl).append(inputelement);\n\n                    inputelement.focus();\n                    inputelement.select();\n                    inputelement.on('keyup keypress focusout', function(e) {\n                        if (cfg.behatsiterunning && e.type === 'focusout') {\n                            // Behat triggers focusout too often.\n                            return;\n                        }\n                        if (e.type === 'keypress' && e.keyCode === 13) {\n                            // We need 'keypress' event for Enter because keyup/keydown would catch Enter that was\n                            // pressed in other fields.\n                            var val = inputelement.val();\n                            turnEditingOff(el);\n                            updateValue(el, val);\n                        }\n                        if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                            // We need 'keyup' event for Escape because keypress does not work with Escape.\n                            turnEditingOff(el);\n                        }\n                    });\n                });\n            };\n\n            var turnEditingOnToggle = function(el, newvalue) {\n                turnEditingOff(el);\n                updateValue(el, newvalue);\n            };\n\n            var turnEditingOnSelect = function(el, options) {\n                var i,\n                    inputelement = $('<select></select>').\n                        attr('id', uniqueId('id_inplacevalue_', 20)).\n                        addClass('custom-select'),\n                    lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>')\n                        .attr('for', inputelement.attr('id'));\n                for (i in options) {\n                    inputelement\n                        .append($('<option>')\n                            .attr('value', options[i].key)\n                            .html(options[i].value));\n                }\n                inputelement.val(el.attr('data-value'));\n\n                el.html('')\n                    .append(lbl)\n                    .append(inputelement);\n\n                inputelement.focus();\n                inputelement.select();\n                inputelement.on('keyup change focusout', function(e) {\n                    if (cfg.behatsiterunning && e.type === 'focusout') {\n                        // Behat triggers focusout too often.\n                        return;\n                    }\n                    if (e.type === 'change') {\n                        var val = inputelement.val();\n                        turnEditingOff(el);\n                        updateValue(el, val);\n                    }\n                    if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                        // We need 'keyup' event for Escape because keypress does not work with Escape.\n                        turnEditingOff(el);\n                    }\n                });\n            };\n\n            var turnEditingOnAutocomplete = function(el, args) {\n                var i,\n                    inputelement = $('<select></select>').\n                        attr('id', uniqueId('id_inplacevalue_', 20)).\n                        addClass('form-autocomplete-original-select').\n                        addClass('custom-select'),\n                    lbl = $('<label class=\"accesshide\">' + mainelement.attr('data-editlabel') + '</label>')\n                        .attr('for', inputelement.attr('id')),\n                    options = args.options,\n                    attributes = args.attributes,\n                    saveelement = $('<a href=\"#\"></a>'),\n                    cancelelement = $('<a href=\"#\"></a>');\n\n                for (i in options) {\n                    inputelement\n                        .append($('<option>')\n                            .attr('value', options[i].key)\n                            .html(options[i].value));\n                }\n                if (attributes.multiple) {\n                    inputelement.attr('multiple', 'true');\n                }\n                inputelement.val(JSON.parse(el.attr('data-value')));\n\n                str.get_string('savechanges', 'core').then(function(s) {\n                    return templates.renderPix('e/save', 'core', s);\n                }).then(function(html) {\n                    saveelement.append(html);\n                    return;\n                }).fail(notification.exception);\n\n                str.get_string('cancel', 'core').then(function(s) {\n                    return templates.renderPix('e/cancel', 'core', s);\n                }).then(function(html) {\n                    cancelelement.append(html);\n                    return;\n                }).fail(notification.exception);\n\n                el.html('')\n                    .append(lbl)\n                    .append(inputelement)\n                    .append(saveelement)\n                    .append(cancelelement);\n\n                inputelement.focus();\n                inputelement.select();\n                autocomplete.enhance(inputelement,\n                    attributes.tags,\n                    attributes.ajax,\n                    attributes.placeholder,\n                    attributes.caseSensitive,\n                    attributes.showSuggestions,\n                    attributes.noSelectionString)\n                    .then(function() {\n                        // Focus on the enhanced combobox.\n                        el.find('[role=combobox]').focus();\n                        // Stop eslint nagging.\n                        return;\n                    }).fail(notification.exception);\n\n                inputelement.on('keyup', function(e) {\n                    if ((e.type === 'keyup' && e.keyCode === 27) || e.type === 'focusout') {\n                        // We need 'keyup' event for Escape because keypress does not work with Escape.\n                        turnEditingOff(el);\n                    }\n                });\n                saveelement.on('click', function(e) {\n                    var val = JSON.stringify(inputelement.val());\n                    // We need to empty the node to destroy all event handlers etc.\n                    inputelement.empty();\n                    turnEditingOff(el);\n                    updateValue(el, val);\n                    e.preventDefault();\n                });\n                cancelelement.on('click', function(e) {\n                    // We need to empty the node to destroy all event handlers etc.\n                    inputelement.empty();\n                    turnEditingOff(el);\n                    e.preventDefault();\n                });\n            };\n\n            var turnEditingOn = function(el) {\n                el.addClass('inplaceeditingon');\n                el.attr('data-oldcontent', el.html());\n\n                var type = el.attr('data-type');\n                var options = el.attr('data-options');\n\n                // Input text inside draggable elements disable text selection in some browsers.\n                // To prevent this we temporally disable any parent draggables.\n                el.parents('[draggable=\"true\"]')\n                    .attr('data-inplace-in-draggable', true)\n                    .attr('draggable', false);\n\n                if (type === 'toggle') {\n                    turnEditingOnToggle(el, options);\n                } else if (type === 'select') {\n                    turnEditingOnSelect(el, $.parseJSON(options));\n                } else if (type === 'autocomplete') {\n                    turnEditingOnAutocomplete(el, $.parseJSON(options));\n                } else {\n                    turnEditingOnText(el);\n                }\n            };\n\n            // Turn editing on for the current element and register handler for Enter/Esc keys.\n            turnEditingOffEverywhere();\n            turnEditingOn(mainelement);\n            editingEnabledPromise.resolve();\n\n        });\n\n\n        return {\n            /**\n             * Return an object to interact with the current inplace editables at a frontend level.\n             *\n             * @param {Element} parent the parent element containing a inplace editable\n             * @returns {Object|undefined} an object to interact with the inplace element, or undefined\n             *                             if no inplace editable is found.\n             */\n            getInplaceEditable: function(parent) {\n                const element = parent.querySelector(`[data-inplaceeditable]`);\n                if (!element) {\n                    return undefined;\n                }\n                // Return an object to interact with the inplace editable.\n                return {\n                    element,\n                    /**\n                     * Get the value from the inplace editable.\n                     *\n                     * @returns {string} the current inplace value\n                     */\n                    getValue: function() {\n                        return this.element.dataset.value;\n                    },\n                    /**\n                     * Force a value change.\n                     *\n                     * @param {string} newvalue the new value\n                     * @fires event:core/inplace_editable:updated\n                     * @fires event:core/inplace_editable:updateFailed\n                     */\n                    setValue: function(newvalue) {\n                        updateValue($(this.element), newvalue, true);\n                    },\n                    /**\n                     * Return the inplace editable itemid.\n                     *\n                     * @returns {string} the current itemid\n                     */\n                    getItemId: function() {\n                        return this.element.dataset.itemid;\n                    },\n                };\n            }\n        };\n    });\n"],"file":"inplace_editable.min.js"}